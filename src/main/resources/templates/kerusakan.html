<div th:fragment="content">

    <!-- ===== HEADER ===== -->
    <div class="mb-4">

        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="mb-0">Data Kerusakan</h3>

            <div>
                <a href="/kerusakan/cetak" class="btn btn-primary me-2">Cetak</a>
                <a href="/kerusakan/tambah" class="btn btn-success">+ Tambah Data</a>
            </div>
        </div>

        <!-- SEARCH -->
        <form method="get" action="/kerusakan">
            <div class="input-group">
                <span class="input-group-text">
                    <i class="bi bi-search"></i>
                </span>
                <input type="text"
                       id="search"
                       name="keyword"
                       class="form-control"
                       placeholder="Cari berdasarkan ID atau Nama Kerusakan..."
                       th:value="${keyword}">
            </div>
        </form>
    </div>

    <!-- ===== TABLE ===== -->
    <div class="table-responsive">
        <table class="table table-bordered bg-white align-middle">
            <thead class="text-center table-light">
            <tr>
                <th>No</th>
                <th>ID</th>
                <th>Nama Kerusakan</th>
                <th>Deskripsi</th>
                <th>Solusi</th>
                <th>Gejala</th>
                <th>Jml.</th>
                <th>Aksi</th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="k, i : ${list}">
                <td class="text-center" th:text="${i.count}"></td>
                <td class="text-center" th:text="${k.id_kerusakan}"></td>
                <td th:text="${k.nama_kerusakan}"></td>
                <td th:text="${k.deskripsi}"></td>
                <td th:text="${k.solusi}"></td>

                <!-- ===== GEJALA ===== -->
                <td>

                    <!-- 2 GEJALA PERTAMA -->
                    <ul class="ps-3 mb-1">
                        <li th:each="g, stat : ${k.gejalaList}"
                            th:if="${stat.index < 2}"
                            th:text="${g.nama_gejala}">
                        </li>
                    </ul>

                    <!-- BUTTON MODAL -->
                    <button type="button"
                            class="btn btn-link p-0 text-primary small"
                            th:if="${#lists.size(k.gejalaList) > 2}"
                            data-bs-toggle="modal"
                            th:attr="data-bs-target='#modalGejala-'+${k.id_kerusakan}">
                        (+<span th:text="${#lists.size(k.gejalaList) - 2}"></span> lainnya)
                    </button>

                </td>

                <td class="text-center"
                    th:text="${#lists.size(k.gejalaList)}"></td>

                <td class="text-center">
                    <a th:href="@{/kerusakan/edit/{id}(id=${k.id_kerusakan})}"
                       class="btn btn-warning btn-sm w-100 mb-1">
                        Edit
                    </a>
                    <button class="btn btn-danger btn-sm w-100" disabled>
                        Hapus
                    </button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- ===== MODAL GEJALA ===== -->
    <div th:each="k : ${list}"
         class="modal fade"
         th:id="'modalGejala-'+${k.id_kerusakan}"
         tabindex="-1">

        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title">
                        Daftar Gejala
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <h6 class="mb-3">
                        Gejala untuk <b th:text="${k.id_kerusakan}"></b>
                    </h6>

                    <ul class="ps-3">
                        <li th:each="g : ${k.gejalaList}"
                            th:text="${g.nama_gejala}">
                        </li>
                    </ul>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">
                        Tutup
                    </button>
                </div>

            </div>
        </div>
    </div>

</div>

